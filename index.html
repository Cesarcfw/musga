<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Player de M√∫sica</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: var(--bg-color);
    color: var(--text-color);
    transition: background 0.3s, color 0.3s;
  }
  :root {
    --bg-color: #f7f7f7;
    --text-color: #333;
    --card-bg: #fff;
    --highlight: #d0eaff;
  }
  body.dark {
    --bg-color: #1e1e1e;
    --text-color: #eee;
    --card-bg: #2c2c2c;
    --highlight: #3a4d5c;
  }
  h2 {
    text-align: center;
    color: var(--text-color);
  }
  #controls {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-top: 1rem;
  }
  input, button {
    padding: 0.5rem;
    border-radius: 5px;
    border: 1px solid #ccc;
    background: var(--card-bg);
    color: var(--text-color);
  }
  button {
    cursor: pointer;
    border: none;
  }
  button.action {
    background: #0078ff;
    color: white;
  }
  button.action:hover {
    background: #005fc0;
  }
  #playlist {
    margin-top: 1.5rem;
    background: var(--card-bg);
    border-radius: 8px;
    padding: 0.5rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .song {
    padding: 8px;
    border-bottom: 1px solid #5553;
    cursor: pointer;
    transition: background 0.2s;
  }
  .song:hover {
    background: var(--highlight);
  }
  .current {
    background: var(--highlight);
    font-weight: bold;
  }
  #player {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
  }
  #top-bar {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
  }
</style>
</head>
<body>

<div id="top-bar">
  <button id="toggleTheme">üåô Modo Escuro</button>
</div>

<h2>üéµ Player de M√∫sica</h2>

<div style="text-align:center;">
  <input type="text" id="inputLink" placeholder="Cole link do YouTube aqui" style="width: 300px;" />
  <button id="btnAdd" class="action">Adicionar</button>
</div>

<div id="controls">
  <button id="btnPrev" class="action">‚èÆ Voltar</button>
  <button id="btnPlay" class="action">‚ñ∂ Play</button>
  <button id="btnPause" class="action">‚è∏ Pause</button>
  <button id="btnSkip" class="action">‚è≠ Avan√ßar</button>
  <button id="btnStop" class="action">‚èπ Parar</button>
</div>

<div id="player"></div>
<div id="playlist"></div>

<script>
// ----------- Tema (Modo Escuro/Claro) -----------
function loadTheme() {
  if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark");
    document.getElementById("toggleTheme").textContent = "‚òÄ Modo Claro";
  }
}
function toggleTheme() {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  document.getElementById("toggleTheme").textContent = isDark ? "‚òÄ Modo Claro" : "üåô Modo Escuro";
  localStorage.setItem("theme", isDark ? "dark" : "light");
}
document.getElementById("toggleTheme").onclick = toggleTheme;
loadTheme();

// ----------- YouTube Player API -----------
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

let player;
let playlist = []; // [{id, title}]
let currentIndex = 0;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    height: '360',
    width: '640',
    events: {
      'onReady': () => console.log("Player pronto!"),
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerStateChange(event) {
  if (event.data === YT.PlayerState.ENDED) {
    skip();
  }
  if (event.data === YT.PlayerState.PLAYING) {
    const data = player.getVideoData();
    if (playlist[currentIndex]) {
      playlist[currentIndex].title = data.title;
      updatePlaylistDisplay();
    }
  }
}

function extractVideoId(url) {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
  const match = url.match(regExp);
  return (match && match[2].length === 11) ? match[2] : null;
}

function playSong(index) {
  if (index < 0 || index >= playlist.length) return;
  currentIndex = index;
  updatePlaylistDisplay();
  player.loadVideoById(playlist[index].id);
}

function updatePlaylistDisplay() {
  const container = document.getElementById("playlist");
  container.innerHTML = "";
  playlist.forEach((song, i) => {
    const div = document.createElement("div");
    div.textContent = song.title || "(Carregando t√≠tulo...)";
    div.className = "song" + (i === currentIndex ? " current" : "");
    div.onclick = () => playSong(i);
    container.appendChild(div);
  });
}

function addSong(url) {
  const id = extractVideoId(url);
  if (!id) {
    alert("Link inv√°lido!");
    return;
  }
  playlist.push({ id, title: "(Carregando t√≠tulo...)" });
  updatePlaylistDisplay();
  // S√≥ toca automaticamente se for a primeira m√∫sica
  if (playlist.length === 1) {
    playSong(0);
  }
}

function skip() {
  if (currentIndex + 1 < playlist.length) {
    playSong(currentIndex + 1);
  } else {
    player.stopVideo();
    alert("Fim da playlist.");
  }
}

function prevSong() {
  if (currentIndex > 0) {
    playSong(currentIndex - 1);
  } else {
    alert("J√° est√° na primeira m√∫sica.");
  }
}

// ----------- Bot√µes -----------
document.getElementById("btnAdd").onclick = () => {
  const url = document.getElementById("inputLink").value.trim();
  if (url) {
    addSong(url);
    document.getElementById("inputLink").value = "";
  }
};
document.getElementById("btnPlay").onclick = () => player.playVideo();
document.getElementById("btnPause").onclick = () => player.pauseVideo();
document.getElementById("btnSkip").onclick = skip;
document.getElementById("btnPrev").onclick = prevSong;
document.getElementById("btnStop").onclick = () => {
  player.stopVideo();
  playlist = [];
  currentIndex = 0;
  updatePlaylistDisplay();
};
</script>

</body>
</html>
