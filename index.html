<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Player de M√∫sica</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f7f7f7;
    color: #333;
  }
  h2 {
    text-align: center;
    color: #444;
  }
  #controls {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-top: 1rem;
  }
  input, button {
    padding: 0.5rem;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
  button {
    background: #0078ff;
    color: white;
    cursor: pointer;
    border: none;
  }
  button:hover {
    background: #005fc0;
  }
  #playlist {
    margin-top: 1.5rem;
    background: white;
    border-radius: 8px;
    padding: 0.5rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .song {
    padding: 8px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background 0.2s;
  }
  .song:hover {
    background: #f0f8ff;
  }
  .current {
    background: #d0eaff;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>üéµ Player de M√∫sica</h2>

<div style="text-align:center;">
  <input type="text" id="inputLink" placeholder="Cole link do YouTube aqui" style="width: 300px;" />
  <button id="btnAdd">Adicionar (PLAY)</button>
</div>

<div id="controls">
  <button id="btnPlay">‚ñ∂ Play</button>
  <button id="btnPause">‚è∏ Pause</button>
  <button id="btnSkip">‚è≠ Skip</button>
  <button id="btnStop">‚èπ Stop</button>
</div>

<div id="playlist"></div>

<!-- Player oculto -->
<div id="player"></div>

<script>
// API do YouTube
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

let player;
let playlist = []; // [{id, title}]
let currentIndex = 0;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    height: '0',
    width: '0',
    events: {
      'onReady': () => console.log("Player pronto!"),
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerStateChange(event) {
  if(event.data === YT.PlayerState.ENDED) {
    skip();
  }
}

function extractVideoId(url) {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
  const match = url.match(regExp);
  return (match && match[2].length === 11) ? match[2] : null;
}

function playSong(index) {
  if(index < 0 || index >= playlist.length) return;
  currentIndex = index;
  updatePlaylistDisplay();
  player.loadVideoById(playlist[index].id);
  player.playVideo();
}

function updatePlaylistDisplay() {
  const container = document.getElementById("playlist");
  container.innerHTML = "";
  playlist.forEach((song, i) => {
    const div = document.createElement("div");
    div.textContent = song.title || song.id;
    div.className = "song" + (i === currentIndex ? " current" : "");
    div.onclick = () => playSong(i);
    container.appendChild(div);
  });
}

function fetchVideoTitle(id, callback) {
  // Carrega o v√≠deo ocultamente para pegar o t√≠tulo com getVideoData()
  let tempPlayer = new YT.Player(document.createElement('div'), {
    videoId: id,
    events: {
      'onReady': (e) => {
        let data = e.target.getVideoData();
        callback(data.title || id);
        tempPlayer.destroy();
      }
    }
  });
}

function addSong(url) {
  const id = extractVideoId(url);
  if(!id) {
    alert("Link inv√°lido!");
    return;
  }
  fetchVideoTitle(id, (title) => {
    playlist.push({id, title});
    updatePlaylistDisplay();
    playSong(playlist.length - 1);
  });
}

function skip() {
  if(currentIndex + 1 < playlist.length) {
    playSong(currentIndex + 1);
  } else {
    player.stopVideo();
    alert("Fim da playlist.");
  }
}

// Event listeners
document.getElementById("btnAdd").onclick = () => {
  const url = document.getElementById("inputLink").value.trim();
  if(url) {
    addSong(url);
    document.getElementById("inputLink").value = "";
  }
};

document.getElementById("btnPlay").onclick = () => player.playVideo();
document.getElementById("btnPause").onclick = () => player.pauseVideo();
document.getElementById("btnSkip").onclick = skip;
document.getElementById("btnStop").onclick = () => {
  player.stopVideo();
  playlist = [];
  currentIndex = 0;
  updatePlaylistDisplay();
};
</script>

</body>
</html>
