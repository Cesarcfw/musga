<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Player de Música Simples</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; }
  #playlist { margin-top: 1rem; }
  .song { cursor: pointer; margin: 4px 0; }
  .current { font-weight: bold; }
  button { margin-right: 0.5rem; }
</style>
</head>
<body>

<h2>Player de Música</h2>

<input type="text" id="inputLink" placeholder="Cole link do YouTube aqui" style="width: 300px;" />
<button id="btnAdd">Adicionar (PLAY)</button>

<div style="margin-top:1rem;">
  <button id="btnPlay">Play</button>
  <button id="btnPause">Pause</button>
  <button id="btnSkip">Skip</button>
  <button id="btnStop">Stop</button>
</div>

<div id="playlist"></div>

<!-- Player oculto -->
<div id="player"></div>

<script>
// API do YouTube
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

let player;
let playlist = [];
let currentIndex = 0;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    height: '0',
    width: '0',
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerReady(event) {
  console.log("Player pronto!");
}

function onPlayerStateChange(event) {
  // Quando música termina, toca próxima
  if(event.data === YT.PlayerState.ENDED) {
    skip();
  }
}

function extractVideoId(url) {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
  const match = url.match(regExp);
  return (match && match[2].length === 11) ? match[2] : null;
}

function playSong(index) {
  if(index < 0 || index >= playlist.length) return;
  currentIndex = index;
  updatePlaylistDisplay();
  player.loadVideoById(playlist[index]);
  player.playVideo();
}

function updatePlaylistDisplay() {
  const container = document.getElementById("playlist");
  container.innerHTML = "";
  playlist.forEach((id, i) => {
    const div = document.createElement("div");
    div.textContent = id;
    div.className = "song" + (i === currentIndex ? " current" : "");
    div.onclick = () => playSong(i);
    container.appendChild(div);
  });
}

function addSong(url) {
  const id = extractVideoId(url);
  if(!id) {
    alert("Link inválido!");
    return;
  }
  playlist.push(id);
  updatePlaylistDisplay();
  playSong(playlist.length - 1);
}

function skip() {
  if(currentIndex + 1 < playlist.length) {
    playSong(currentIndex + 1);
  } else {
    player.stopVideo();
    alert("Fim da playlist.");
  }
}

// Event listeners dos botões
document.getElementById("btnAdd").onclick = () => {
  const url = document.getElementById("inputLink").value.trim();
  if(url) {
    addSong(url);
    document.getElementById("inputLink").value = "";
  }
};

document.getElementById("btnPlay").onclick = () => {
  player.playVideo();
};

document.getElementById("btnPause").onclick = () => {
  player.pauseVideo();
};

document.getElementById("btnSkip").onclick = skip;

document.getElementById("btnStop").onclick = () => {
  player.stopVideo();
  playlist = [];
  currentIndex = 0;
  updatePlaylistDisplay();
};

</script>

</body>
</html>
